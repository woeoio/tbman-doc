<!DOCTYPE html>

<html lang="zh-CN"  class="">


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="keywords" content="">
    
    
    <meta name="description" content="">
    
    <meta name="generator" content="teedoc">
    <meta name="theme" content="teedoc-plugin-theme-default">
    
        
        <meta name="markdown-generator" content="teedoc-plugin-markdown-parser">
        
        <script>
MathJax = {"loader": {"load": ["output/svg"]}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}, "svg": {"fontCache": "global"}};
</script>
        
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
        <script src="/static/js/theme_default/pre_main.js"></script>
        
        <link rel="stylesheet" href="/static/css/theme_default/prism.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/viewer.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/dark.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/light.css" type="text/css"/>
        
        <script src="/static/js/theme_default/jquery.min.js"></script>
        
        <script src="/static/js/theme_default/split.js"></script>
        
        <link rel="stylesheet" href="/static/css/search/style.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/custom.css" type="text/css"/>
        
    
    
    <title>Property Sheet & Object Serialization - 开发手册 | twinbasic.com.cn</title>
    
    <script type="text/javascript">js_vars = {}</script>
    <script type="text/javascript">metadata = {"tags": [], "date": null, "update": [], "ts": 0, "author": "", "brief": "", "cover": ""}</script>
</head>


<body class="type_doc">
    
    <div id="navbar">
        <div id="navbar_menu">
            <a class="site_title" href="/">
                
                
                    <h2>开发手册</h2>
                
        </a>
            <a id="navbar_menu_btn"></a>
        </div>
        <div id="navbar_items">
            <div>
                <ul id="nav_left">
<li class=""><a  href="/twinbasic/">twinbasic</a></li>
<li class=""><a  href="/tbman/">tbman</a></li>
<li class="active"><a  href="/official/">官方文档</a></li>
</ul>

            </div>
            <div>
                <ul id="nav_right">
<li class=""><a target="_blank" href="https://twinbasic.com.cn">首页</a></li>
</ul>

                <ul class="nav_plugins"><li><a id="themes" class="light"></a></li></ul><ul class="nav_plugins"><li><a id="search"><span class="icon"></span><span class="placeholder">搜索</span>
                            <div id="search_hints">
                                <span id="search_input_hint">输入关键词，多关键词空格隔开</span>
                                <span id="search_loading_hint">正在加载，请稍候。。。</span>
                                <span id="search_download_err_hint">下载文件失败，请刷新重试或检查网络</span>
                                <span id="search_other_docs_result_hint">来自其它文档的结果</span>
                                <span id="search_curr_doc_result_hint">当前文档搜索结果</span>
                            </div></a></li></ul>
            </div>
        </div>
    </div>
    
    <div id="wrapper">
        <div id="sidebar_wrapper">
            <div id="sidebar">
                <div id="sidebar_title">
                    
                </div>
                <ul class="">
<li class="not_active no_link sidebar_category"><span class="label">简介</span></li>
<li class="not_active with_link"><a href="/official/index.html"><span class="label">欢迎使用</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=start/Install.html&from=/official/start/Install.html"><span class="label">安装指引</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=start/KnownIssues.html&from=/official/start/KnownIssues.html"><span class="label">已知问题</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=start/ChangeLog.html&from=/official/start/ChangeLog.html"><span class="label">更新日志</span><span class=""></span></a></li>
<li class="not_active no_link sidebar_category"><span class="label">开发</span></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=dev/hello.html&from=/official/dev/hello.html"><span class="label">快速入门</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=dev/more.html&from=/official/dev/more.html"><span class="label">更多...</span><span class=""></span></a></li>
<li class="not_active no_link sidebar_category"><span class="label">关于</span></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=about/Collaboration.html&from=/official/about/Collaboration.html"><span class="label">协作</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=about/OfThanks.html&from=/official/about/OfThanks.html"><span class="label">致谢</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=about/Donate.html&from=/official/about/Donate.html"><span class="label">捐赠</span><span class=""></span></a></li>
</ul>

            </div>
        </div>
        <div id="article">
            <div id="menu_wrapper">
                <div id="menu">
                </div>
            </div>
            <div id="content_wrapper">
                <div id="content_body">
                    <div id="article_head">
                        <div id="article_title">
                            
                            <h1>Property Sheet & Object Serialization</h1>
                            
                        </div>
                        <div id="article_tags">
                            <ul>
                            
                            </ul>
                        </div>
                        <div id="article_info">
                        <div id="article_info_left">
                            <span class="article_author">
                                
                            </span>
                            
                                <span class="article_date" title="最后修改日期： 2024-07-09">
                                    2024-07-09
                                </span>
                            
                        </div>
                        <div id="article_info_right">
                            
                        </div>
                        </div>
                    </div>
                    <div id="article_tools">
                        <span></span>
                        <span id="toc_btn"></span>
                    </div>
                    <div id="update_history">
                        
                    </div>
                    <div id="article_content">
                        
                            <p>The form designer property sheet will pickup any <strong><em>public</em></strong> custom properties (fields) that you expose via your CustomControl class.  For example, adding a field <code>Public MyField As Long</code> will then automatically show up in the control property sheet in the form designer:</p>
<p><img src="https://www.twinbasic.com/images/wiki/ccMyFieldPropertySheet1a.png" alt="CustomControl MyField propertySheet" /></p>
<p>This is then persisted to your project as properties inside your form JSON structure:</p>
<p><img src="https://www.twinbasic.com/images/wiki/ccMyFieldJson1a.png" alt="CustomControl MyField JSON" /></p>
<p>The key to making this work is your serialization constructor, which might look something like this:</p>

<pre class="language-none"><code class="language-none">Public Sub New(Serializer As SerializationInfo)
   If Not Serializer.Deserialize(Me) Then
      InitializeDefaultValues  ' you implement this
   End If
End Sub
</code></pre>
<p>If <code>Deserialize(Me)</code> returns <code>True</code>, then your class properties were synchronized with the properties set via the form designer.  If it returns <code>False</code> then the control has just been added to the form, and this gives you an opportunity to setup any suitable default values for your custom public properties.  The form designer notices default values you set within the serialization constructor, so that your property sheet is kept in-sync.</p>
<hr />
<h3 id="Default-Values">Default Values</h3>
<p>An alternative method for setting up default values is to inline them into the class field definition:</p>
<p><img src="https://www.twinbasic.com/images/wiki/ccMyFieldPropertySheet1b.png" alt="CustomControl MyField = 42" /></p>
<p>The <code>Deserialize(Me)</code> call inside your serialization constructor will overwrite the property value if  the control is being synchronized from the persisted property sheet data.</p>
<hr />
<h3 id="Enumerations">Enumerations</h3>
<p>Enumerations that you define in your twinBASIC project are supported.  Simply expose a class field with the enumeration:</p>
<p><img src="https://www.twinbasic.com/images/wiki/ccMyEnumFieldPropertySheet.png" alt="CustomControl enumeration property sheet example" /></p>
<p>Note:  Enumerations are persisted to the form JSON structure as strings, so bare this in mind when making changes/updates to a CustomControl so that you don't introduce breaking changes by renaming an enumeration value.</p>
<hr />
<h3 id="Objects">Objects</h3>
<p>Class objects that you define in your twinBASIC project are supported.  You *<strong>must</strong>* supply a ClassId attribute for any exposed object, so that the serialization can identify it.</p>
<p><img src="https://www.twinbasic.com/images/wiki/ccMyFieldClass.png" alt="CustomControl class property sheet example" /></p>
<hr />
<h3 id="Arrays">Arrays</h3>
<p>Arrays are supported.   The form designer allows for adding new elements, removing elements, and re-ordering of elements (via drag/drop).</p>
<p><img src="https://www.twinbasic.com/images/wiki/ccMyFieldArray.png" alt="CustomControl array property sheet example" /></p>
<hr />
<h3 id="Property-Get-/-Let">Property Get / Let</h3>
<p>Custom property procedures are supported.  You will find that using Property Get / Let procedures is required if you want property changes to trigger repainting of your control.</p>
<p><img src="https://www.twinbasic.com/images/wiki/ccMyFieldCustomProperty.png" alt="CustomControl custom property example" /></p>
<p>Note that <em><strong>private</strong></em> fields and properties do not form part of the serialization, and so will not appear on the property sheet.</p>
<hr />
<h3 id="Avoid-Variants">Avoid Variants</h3>
<p>The serialization does not support Variants or generic Objects.  Always use strongly-typed datatypes.</p>
<hr />
<h3 id="Events">Events</h3>
<p>Events that you define in your class will be exposed in the Events property sheet:</p>
<p><img src="https://www.twinbasic.com/images/wiki/ccEvents.png" alt="CustomControl attribute" /></p>
<p>At the moment, the form-designer doesn't yet support code-behind-forms, so this feature is not yet complete.</p>
<hr />
<h3 id="Tips">Tips</h3>
<ul>
<li><p>If you make changes to your CustomControl class, such as exposing new properties or changing how a control is drawn, these changes will get reflected immediately to any open form designers.  Form designers will show a 'resync' button when you return to them, once pressed the changes will be apparent.</p>
</li>
<li><p>The serialization happens via JSON when running in the IDE, but via a binary format when running in a compiled DLL/EXE.  The <code>SerializationInfo</code> object that is passed to your serialization constructor is a different implementation when running in the IDE, but this should be transparent to you as a CustomControl implementer.</p>
</li>
<li><p>When making changes or updates to a CustomControl always consider backwards compatibility.  For example, if you rename an exposed property, the old property values stored via the property sheet won't be deserialized to your new property.</p>
</li>
</ul>

                        
                    </div>
                </div>
                <div id="previous_next">
                    <div id="previous">
                        
                    </div>
                    <div id="next">
                        
                    </div>
                </div>
                <div id="comments-container"></div>
            </div>
            <div id="toc_wrapper">
                <div id="toc">
                    <div id="toc_content">
                            
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a id="to_top" href="#"></a>
    <div id="doc_footer">
        <div id="footer">
            <div id="footer_top">
                <ul>
<li><a></a><ul><li><a target="_blank" href="/#"></a></li>
</ul>
</li>
</ul>

            </div>
            <div id="footer_bottom">
                <ul>
<li><a target="_blank" href="https://vb6.pro">欢迎访问 vb6.pro 资源站点</a></li>
</ul>

            </div>
        </div>
    </div>
    
        <script src="/teedoc-plugin-markdown-parser/mermaid.min.js"></script>
    
        <script>mermaid.initialize({startOnLoad:true});</script>
    
        <script src="/static/js/theme_default/tocbot.min.js"></script>
    
        <script src="/static/js/theme_default/main.js"></script>
    
        <script src="/static/js/theme_default/viewer.min.js"></script>
    
        <script src="/static/css/theme_default/prism.min.js"></script>
    
        <script src="/static/js/search/search_main.js"></script>
    
        <script src="/static/js/custom.js"></script>
    
        <script src="http://api.a-vi.com/tongji/vist.js"></script>
    
        <script type="text/javascript" src="/static/js/live.js"></script>
    
</body>

</html>