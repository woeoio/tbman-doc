<!DOCTYPE html>

<html lang="zh-CN"  class="">


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="keywords" content="">
    
    
    <meta name="description" content="">
    
    <meta name="generator" content="teedoc">
    <meta name="theme" content="teedoc-plugin-theme-default">
    
        
        <meta name="markdown-generator" content="teedoc-plugin-markdown-parser">
        
        <script>
MathJax = {"loader": {"load": ["output/svg"]}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}, "svg": {"fontCache": "global"}};
</script>
        
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
        <script src="/static/js/theme_default/pre_main.js"></script>
        
        <link rel="stylesheet" href="/static/css/theme_default/prism.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/viewer.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/dark.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/light.css" type="text/css"/>
        
        <script src="/static/js/theme_default/jquery.min.js"></script>
        
        <script src="/static/js/theme_default/split.js"></script>
        
        <link rel="stylesheet" href="/static/css/search/style.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/custom.css" type="text/css"/>
        
    
    
    <title>Painting / drawing to your control - 开发手册 | twinbasic.com.cn</title>
    
    <script type="text/javascript">js_vars = {}</script>
    <script type="text/javascript">metadata = {"tags": [], "date": null, "update": [], "ts": 0, "author": "", "brief": "", "cover": ""}</script>
</head>


<body class="type_doc">
    
    <div id="navbar">
        <div id="navbar_menu">
            <a class="site_title" href="/">
                
                
                    <h2>开发手册</h2>
                
        </a>
            <a id="navbar_menu_btn"></a>
        </div>
        <div id="navbar_items">
            <div>
                <ul id="nav_left">
<li class=""><a  href="/twinbasic/">twinbasic</a></li>
<li class=""><a  href="/tbman/">tbman</a></li>
<li class="active"><a  href="/official/">官方文档</a></li>
</ul>

            </div>
            <div>
                <ul id="nav_right">
<li class=""><a target="_blank" href="https://twinbasic.com.cn">首页</a></li>
</ul>

                <ul class="nav_plugins"><li><a id="themes" class="light"></a></li></ul><ul class="nav_plugins"><li><a id="search"><span class="icon"></span><span class="placeholder">搜索</span>
                            <div id="search_hints">
                                <span id="search_input_hint">输入关键词，多关键词空格隔开</span>
                                <span id="search_loading_hint">正在加载，请稍候。。。</span>
                                <span id="search_download_err_hint">下载文件失败，请刷新重试或检查网络</span>
                                <span id="search_other_docs_result_hint">来自其它文档的结果</span>
                                <span id="search_curr_doc_result_hint">当前文档搜索结果</span>
                            </div></a></li></ul>
            </div>
        </div>
    </div>
    
    <div id="wrapper">
        <div id="sidebar_wrapper">
            <div id="sidebar">
                <div id="sidebar_title">
                    
                </div>
                <ul class="">
<li class="not_active no_link sidebar_category"><span class="label">简介</span></li>
<li class="not_active with_link"><a href="/official/index.html"><span class="label">欢迎使用</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=start/Install.html&from=/official/start/Install.html"><span class="label">安装指引</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=start/KnownIssues.html&from=/official/start/KnownIssues.html"><span class="label">已知问题</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=start/ChangeLog.html&from=/official/start/ChangeLog.html"><span class="label">更新日志</span><span class=""></span></a></li>
<li class="not_active no_link sidebar_category"><span class="label">开发</span></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=dev/hello.html&from=/official/dev/hello.html"><span class="label">快速入门</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=dev/more.html&from=/official/dev/more.html"><span class="label">更多...</span><span class=""></span></a></li>
<li class="not_active no_link sidebar_category"><span class="label">关于</span></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=about/Collaboration.html&from=/official/about/Collaboration.html"><span class="label">协作</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=about/OfThanks.html&from=/official/about/OfThanks.html"><span class="label">致谢</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/official/no_translate.html?ref=about/Donate.html&from=/official/about/Donate.html"><span class="label">捐赠</span><span class=""></span></a></li>
</ul>

            </div>
        </div>
        <div id="article">
            <div id="menu_wrapper">
                <div id="menu">
                </div>
            </div>
            <div id="content_wrapper">
                <div id="content_body">
                    <div id="article_head">
                        <div id="article_title">
                            
                            <h1>Painting / drawing to your control</h1>
                            
                        </div>
                        <div id="article_tags">
                            <ul>
                            
                            </ul>
                        </div>
                        <div id="article_info">
                        <div id="article_info_left">
                            <span class="article_author">
                                
                            </span>
                            
                                <span class="article_date" title="最后修改日期： 2024-07-09">
                                    2024-07-09
                                </span>
                            
                        </div>
                        <div id="article_info_right">
                            
                        </div>
                        </div>
                    </div>
                    <div id="article_tools">
                        <span></span>
                        <span id="toc_btn"></span>
                    </div>
                    <div id="update_history">
                        
                    </div>
                    <div id="article_content">
                        
                            <h3 id="The-ICustomControl.Paint-method">The ICustomControl.Paint method</h3>
<p>This is by far the most important method of a CustomControl.  It tells the form engine exactly how you want it to render your control.</p>
<p><em><strong>TIP: It is highly advisable to look at and experiment with the sample project provided with twinBASIC before trying to implement your own CustomControl.</strong></em></p>

<pre class="language-none"><code class="language-none">Private Sub OnPaint(ByVal Canvas As CustomControls.Canvas)  _
    Implements ICustomControl.Paint

</code></pre>
<p>You are passed a Canvas object that offers the following methods:</p>

<pre class="language-none"><code class="language-none">Canvas.Width As Long   [Propert-Get]
Canvas.Height As Long   [Propert-Get]
Canvas.Dpi As Long   [Propert-Get]
Canvas.DpiScaleFactor As Double [Propert-Get]
Canvas.AddElement(Descriptor As ElementDescriptor)

</code></pre>
<p><code>Canvas.Width</code> and <code>Canvas.Height</code> are the absolute pixel sizes that your control is drawing to.  Unlike your controls Width/Height properties that are not DPI-scaled, the <code>Canvas.Width</code> and <code>Canvas.Height</code> values <strong>are</strong> DPI-scaled.</p>
<p>The <code>Canvas.Dpi</code> property represents the DPI setting in Windows.  If no DPI scaling is in effect, this value is 96.  For example, if you have scaling set at 150% on your monitor, then the <code>Canvas.Dpi</code> property will be 144.</p>
<p>The <code>Canvas.DpiScaleFactor</code> property gives a floating point value representing the DPI scaling percentage.  A value of 1 indicates no scaling.  For example, if you have scaling set at 150% on your monitor, then the <code>Canvas.DpiScaleFactor</code> property will be 1.5.</p>
<p>The <code>Canvas.AddElement</code> method is used for adding elements to your control.  An <em>element</em> is considered to be something that the form-engine will render for you.  For example, you might have a grid control that displays 100 cells at a time.  Each of those cells would be an <em>element</em>.  Elements can overlap each over (allowing for opacity/transparency).  The form engine draws them in the order that you call AddElement, meaning that the last element added will have the highest z-order.</p>
<hr />
<h3 id="AddElement%28ElementDescriptor%29">AddElement(ElementDescriptor)</h3>
<p>The AddElement method takes a single argument; an ElementDescriptor.  ElementDescriptor is a UDT that defines exactly how the element will be drawn and how it reacts to events like mouse clicks.</p>

<pre class="language-none"><code class="language-none">Public Type ElementDescriptor
   OnClick As LongPtr               ' event function callback pointer
   OnDblClick As LongPtr            ' event function callback pointer
   OnMouseDown As LongPtr           ' event function callback pointer
   OnMouseUp As LongPtr             ' event function callback pointer
   OnMouseEnter As LongPtr          ' event function callback pointer
   OnMouseLeave As LongPtr          ' event function callback pointer
   OnMouseMove As LongPtr           ' event function callback pointer
   OnScrollH As LongPtr             ' event function callback pointer
   OnScrollV As LongPtr             ' event function callback pointer
   Left As Long                     ' pixel offset (control relative, DPI scaled)
   Top As Long                      ' pixel offset (control relative, DPI scaled)
   Width As Long                    ' pixel width (DPI scaled)
   Height As Long                   ' pixel width (DPI scaled)
   Cursor As MousePointerConstants  ' cursor/pointer icon
   TrackingIdX As LongLong          ' for tracking this element, passed to events
   TrackingIdY As LongLong          ' for tracking this element, passed to events
   Text As String                   ' the text to render
   TextRenderingOptions As TextRendering ' options to customize text rendering (object)
   BackgroundFill As Fill           ' options to customize back fill rendering (object)
   Corners As Corners               ' options to customize corner rendering (object)
   Borders As Borders               ' options to customize border rendering (object)
End Type
</code></pre>
<hr />
<h3 id="Tips">Tips</h3>
<ul>
<li><p>Each time your OnPaint method is called, you start with a blank canvas.</p>
</li>
<li><p>Left/Top/Width/Height can legitimately be outside of the canvas area.  For example, negative Left/Top, or a Width/Height past the Canvas.Width/Canvas.Height has no ill-effects.  The form engine will clip everything appropriately for you, allowing for much simpler designing of your control.</p>
</li>
<li><p>You should put thought into making the Paint routine efficient.  Try not to instantiate COM objects, and when drawing multiple similar elements, try to re-use ElementDescriptors by setting up common properties outside of loops (see WaynesGrid for examples of this)</p>
</li>
<li><p>TrackingIdX and TrackingIdY are important when you have multiple elements within a control.   The two values, when combined, should uniquely represent the element, and must be maintained if your Paint routine is called again.  This is needed for supporting events.  For example, in a grid control, each cell would have a TrackingIdX / TrackingIdY value associated with it, given the X/Y co-ordinates of the cell.</p>
</li>
<li><p>Currently, only mouse events are provided, but focus events are coming soon, as well as keyboard events.</p>
</li>
<li><p>You can use class-based event handlers by simply using the <code>AddressOf MyEvent</code> which is now possible to use even on class members.  You can see this used frequently in the samples, such as WaynesGrid.    All mouse events have the following format:</p>
</li>
</ul>

<pre class="language-none"><code class="language-none">Class MyCustomControl
    ...
    Private Sub MyClickEvent(ByRef EventInfo As MouseEvent)
        MsgBox &quot;You clicked me!&quot;
    End Sub

    Private Sub OnPaint(ByVal Canvas As CustomControls.Canvas)  _
            Implements ICustomControl.Paint
        Dim MyDescriptor As ElementDescriptor
        MyDescriptor.OnClick = AddressOf MyClickEvent
    End Sub
</code></pre>
<p>EventInfo (MouseEvent) provides mouse information such as the relative X/Y position of the mouse, plus the TrackingX/Y values discussed earlier.</p>
<ul>
<li>When you call Canvas.AddElement, your element goes into a render pipeline.  It is <strong>not</strong> immediately painted to the screen.   The render pipeline is compared to the previous render pipeline that was provided by you in the last OnPaint call, and the tB form engine will only redraw areas of the control that have changed.  This allows for efficient painting of controls whilst not needing to be concerned about the finer details of how to do partial repainting.</li>
</ul>

                        
                    </div>
                </div>
                <div id="previous_next">
                    <div id="previous">
                        
                    </div>
                    <div id="next">
                        
                    </div>
                </div>
                <div id="comments-container"></div>
            </div>
            <div id="toc_wrapper">
                <div id="toc">
                    <div id="toc_content">
                            
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a id="to_top" href="#"></a>
    <div id="doc_footer">
        <div id="footer">
            <div id="footer_top">
                <ul>
<li><a></a><ul><li><a target="_blank" href="/#"></a></li>
</ul>
</li>
</ul>

            </div>
            <div id="footer_bottom">
                <ul>
<li><a target="_blank" href="https://vb6.pro">欢迎访问 vb6.pro 资源站点</a></li>
</ul>

            </div>
        </div>
    </div>
    
        <script src="/teedoc-plugin-markdown-parser/mermaid.min.js"></script>
    
        <script>mermaid.initialize({startOnLoad:true});</script>
    
        <script src="/static/js/theme_default/tocbot.min.js"></script>
    
        <script src="/static/js/theme_default/main.js"></script>
    
        <script src="/static/js/theme_default/viewer.min.js"></script>
    
        <script src="/static/css/theme_default/prism.min.js"></script>
    
        <script src="/static/js/search/search_main.js"></script>
    
        <script src="/static/js/custom.js"></script>
    
        <script src="http://api.a-vi.com/tongji/vist.js"></script>
    
        <script type="text/javascript" src="/static/js/live.js"></script>
    
</body>

</html>